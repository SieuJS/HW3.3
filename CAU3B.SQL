-- KET NOI VOI VAI TRO GIAM DOC
CONN NV001/NV001@//LOCALHOST:1523/ORCLDOCKER;
ALTER SESSION SET CURRENT_SCHEMA = QL_NHANSU;

-- CAP QUYEN DOC TREN QUAN HE TONG HOP
DECLARE
    CURSOR CUR IS (
        SELECT MANV FROM QL_NHANSU.NHANVIEN
        WHERE CHUCVU = 'TRƯỞNG PHÒNG'
        AND MANV IN (
            SELECT USERNAME FROM ALL_USERS
            WHERE USERNAME LIKE 'NV00%'
        )
        AND MANV != 'NV001'
    );
    STRSQL NVARCHAR2(2000);
    USR NVARCHAR2(5);
BEGIN
    OPEN CUR;
    LOOP
        FETCH CUR INTO USR;
        EXIT WHEN CUR%NOTFOUND;
        STRSQL := 'GRANT SELECT ON VW_TONGHOP_CHI TO ' || USR || ' WITH GRANT OPTION';
        EXECUTE IMMEDIATE (STRSQL) ; 
        STRSQL := 'GRANT SELECT ON VW_TONGHOP_THU TO ' || USR || ' WITH GRANT OPTION';
        EXECUTE IMMEDIATE (STRSQL) ;
        STRSQL := 'GRANT SELECT ON VW_TONGHOP_NAM TO ' || USR || ' WITH GRANT OPTION';
        EXECUTE IMMEDIATE (STRSQL) ;
    END LOOP;
    CLOSE CUR;
END;
/
DISCONNECT;