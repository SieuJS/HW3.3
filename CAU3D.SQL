CONN NV001/NV001@//LOCALHOST:1523/ORCLDOCKER;

ALTER SESSION SET CURRENT_SCHEMA = QL_NHANSU;

-- LAY LAI QUYEN DOC TREN THUOC TINH CHI 
DECLARE 
    CURSOR CUR IS (
        SELECT MANV FROM NHANVIEN
        WHERE CHUCVU = 'TRƯỞNG PHÒNG'
        AND MANV IN (
            SELECT USERNAME FROM ALL_USERS
            WHERE USERNAME LIKE 'NV0%'
        )
    );
    STRSQL NVARCHAR2(2000); 
    USR NVARCHAR2(5);
BEGIN
    OPEN CUR;
    LOOP 
        FETCH CUR INTO USR;
        EXIT WHEN CUR%NOTFOUND;
        STRSQL := 'REVOKE SELECT ON VW_TONGHOP_CHI FROM ' || USR;
        EXECUTE IMMEDIATE(STRSQL);
    END LOOP;
    CLOSE CUR;
END;
/

DISCONN;