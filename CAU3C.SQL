-- KET NOI VOI VAI TRO TRUONG PHONG
CONN NV002/NV002@//LOCALHOST:1523/ORCLDOCKER;

ALTER SESSION SET CURRENT_SCHEMA = QL_NHANSU;
-- CAP QUYEN DOC TREN TONG HOP
DECLARE 
    CURSOR CUR IS (
        SELECT MANV FROM NHANVIEN
        WHERE CHUCVU = 'NHÂN VIÊN'
        AND MANV IN (
            SELECT USERNAME FROM ALL_USERS
            WHERE USERNAME LIKE 'NV0%'
        )
    );
    STRSQL NVARCHAR2(2000) ; 
    USR NVARCHAR2(5);
BEGIN 
    OPEN CUR;
    LOOP
        FETCH CUR INTO USR;
        EXIT WHEN CUR%NOTFOUND;
        STRSQL := 'GRANT SELECT ON VW_TONGHOP_CHI TO ' || USR ;
        EXECUTE IMMEDIATE (STRSQL) ; 
        STRSQL := 'GRANT SELECT ON VW_TONGHOP_THU TO ' || USR;
        EXECUTE IMMEDIATE (STRSQL) ;
        STRSQL := 'GRANT SELECT ON VW_TONGHOP_NAM TO ' || USR ;
        EXECUTE IMMEDIATE (STRSQL) ;
    END LOOP;
    CLOSE CUR;
END;
/

DISCONNECT;